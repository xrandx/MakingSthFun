<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>16ËÆ°ÂÅ•Â∫∑Á†ÅÊî∂ÈõÜ</title>
    <script src="../static/vue.js"></script>
    <script src="../static/axios.js"></script>
    <script src="../static/index.js"></script>
    <link rel="stylesheet" href="../static/theme.css">
    <style>
        .avatar-uploader .el-upload {
            border: 1px dashed #d9d9d9;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .avatar-uploader .el-upload:hover {
            border-color: #409EFF;
        }

        .avatar-uploader-icon {
            font-size: 28px;
            color: #8c939d;
            width: 178px;
            height: 178px;
            line-height: 178px;
            text-align: center;
        }

        .avatar {
            width: 178px;
            height: 178px;
            display: block;
        }

        img {
            width: auto;
            height: auto;
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>


<el-row>
    <el-col id="dialog">
        <el-form :label-position="'left'">
            <el-form-item><h1>16ËÆ°ÂÅ•Â∫∑Á†ÅÊî∂ÈõÜ</h1></el-form-item>

            <el-form-item label="ÂêçÂ≠ó">
                <el-col :span="18">
                    <el-input v-model="name" prop="name" preholder="ËØ∑ËæìÂÖ•ÂêçÂ≠ó"></el-input>
                </el-col>
            </el-form-item>

            <el-form-item label="‰∏ä‰º†">
                <el-col :span="20">
                    <el-button><input type="file" value="" id="file" @change="uploadConfig">
                    </el-button>
                </el-col>
                <el-col :span="24">
                    <el-divider></el-divider>
                </el-col>
                <el-col :span="8">
                    <img v-if="imageUrl" :src="imageUrl" alt="ÂõæÁâá‰∏ä‰º†Â§±Ë¥•">
                    </i>
                </el-col>
            </el-form-item>
            <el-form-item label="ËøõÂ∫¶">
                <el-col :span="20">
                    <el-progress :percentage="percentage" status="success"></el-progress>
                </el-col>
            </el-form-item>


        </el-form>

        <el-col>

            <el-row :gutter="10">
                <el-col :span="22" :offset="1"><h3>Êú™‰∫§ÁöÑ‰∫∫:{{tableData.length}}‰∏™</h3></el-col>
                <el-col>
                    <el-divider>ÁÇπÂáªÂç°ÁâáÂèØÈÄâÊã©ÂêçÂ≠ó</el-divider>
                </el-col>
                <el-col v-for="card in tableData" :span="8">

                    <el-card shadow="hover">
                        <div @click="assignmentName">
                            {{card.forget_name}}
                        </div>
                    </el-card>


                </el-col>
            </el-row>
        </el-col>
    </el-col>
</el-row>

</body>

<script>
    BASE = window.document.location.href;
    vm = new Vue({
        el: '#dialog',
        data: {
            name: '',
            imageUrl: '',
            percentage: 0,
            tableData: []
        },
        computed: {
            // ËÆæÁΩÆËØ∑Ê±ÇÂ§¥
            headers() {
                return {
                    // ËÆæÁΩÆContent-TypeÁ±ªÂûã‰∏∫multipart/form-data
                    'ContentType': 'multipart/form-data',
                }
            },
            // ËÆæÁΩÆ‰∏ä‰º†Âú∞ÂùÄ
        },

        methods: {
            uploadConfig(e) {
                if (this.name == "") {
                    this.$message.error('ËØ∑Â°´ÂÜôÂßìÂêç')
                } else {
                    let formData = new FormData();
                    let data = JSON.stringify({
                        name: this.name
                    });
                    formData.append('data', data);   // ‰∏ä‰º†Êñá‰ª∂ÁöÑÂêåÊó∂Ôºå ‰πüÂèØ‰ª•‰∏ä‰º†ÂÖ∂‰ªñÊï∞ÊçÆ
                    formData.append('file', e.target.files[0]);
                    let config = {
                        headers: {'Content-Type': 'multipart/form-data'}
                    };
                    axios.post("upload", formData, config).then(res => {
                        if (res.code === 200 || res.code == null || res.code === 0) {
                            for (; this.percentage < 100; this.percentage++) ;
                            this.$message({
                                message: 'ÊàêÂäü‰∏ä‰º†‰Ω†ÁöÑÂÅ•Â∫∑Á†ÅüòÇÂÜçËßÅ',
                                type: 'success'
                            });
                            this.imageUrl = BASE + res.data;
                            this.forget();
                        } else {
                            this.$message.error(res.msg || res.message || 'Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•')
                        }

                    }).catch((err) => {
                        this.$message.error(err.message || 'Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•')
                    })
                }


            },
            forget() {
                var self = this;
                axios.get(BASE + "forget").then(function (response) {
                    self.tableData = response.data;
                })
            },
            assignmentName(e) {
                this.name = e.target.innerText;
            }
        },
        mounted: function () {
            this.forget();
        }

    })


</script>
</html>